# TextScope Production Deployment Guide

## Overview
This guide covers deploying TextScope to production on Render with PostgreSQL database and spaCy NLP processing.

## Prerequisites
- Render account
- GitHub repository with your TextScope code
- Domain name (optional, for custom domain)

## Deployment Steps

### 1. Database Setup
1. In Render dashboard, create a new PostgreSQL database:
   - Name: `textscope-db`
   - Plan: `Starter` (or higher for production)
   - Region: Choose closest to your users

2. Note the database connection string from the database dashboard

### 2. Web Service Setup
1. Create a new Web Service in Render:
   - Connect your GitHub repository
   - Name: `textscope`
   - Environment: `Python`
   - Build Command: (automatically detected from render.yaml)
   - Start Command: (automatically detected from render.yaml)

### 3. Environment Variables
Set the following environment variables in Render:

**Required:**
- `ENVIRONMENT`: `production`
- `DATABASE_URL`: (automatically set from database connection)
- `SECRET_KEY`: (automatically generated by Render)
- `ALGORITHM`: `HS256`
- `ACCESS_TOKEN_EXPIRE_MINUTES`: `30`

**Optional:**
- `MAX_CONTENT_LENGTH`: `10000`
- `REQUEST_TIMEOUT`: `30`
- `RATE_LIMIT_PER_MINUTE`: `60`
- `LOG_LEVEL`: `INFO`
- `WORKERS`: `4`
- `CORS_ORIGINS`: `*` (or your specific domains)
- `SENTRY_DSN`: (for error tracking)

### 4. Custom Domain (Optional)
1. In your web service settings, add your custom domain
2. Update CORS_ORIGINS to include your domain
3. Update TrustedHostMiddleware in main.py with your domain

## Production Features

### Security
- ✅ HTTPS enforced
- ✅ Security headers (HSTS, XSS protection, etc.)
- ✅ CORS properly configured
- ✅ Trusted host middleware
- ✅ Input validation and sanitization
- ✅ Rate limiting ready (implement if needed)

### Database
- ✅ PostgreSQL with connection pooling
- ✅ Automatic failover handling
- ✅ Health checks
- ✅ Migration support

### Monitoring
- ✅ Comprehensive logging
- ✅ Health check endpoint (`/health`)
- ✅ Error tracking (Sentry integration ready)
- ✅ Performance monitoring

### NLP Processing
- ✅ spaCy model verification on startup
- ✅ TextBlob integration
- ✅ Graceful error handling
- ✅ Memory-efficient processing

## Health Monitoring

### Health Check Endpoint
- URL: `https://your-domain.com/health`
- Returns service status and component health
- Monitors: Database, spaCy, TextBlob

### Logging
- Structured logging with timestamps
- Different log levels (INFO, WARNING, ERROR)
- Request tracking with user context

## Performance Optimization

### Application
- Gunicorn with 4 workers
- Uvicorn async workers
- Connection pooling
- Request/response optimization

### Database
- Connection pooling (10 connections)
- Query optimization
- Automatic reconnection

### Memory Management
- spaCy model preloading
- Efficient text processing
- Garbage collection optimization

## Scaling

### Horizontal Scaling
- Auto-scaling: 1-3 instances
- CPU/Memory based scaling
- Load balancing included

### Database Scaling
- Upgrade database plan as needed
- Read replicas (higher plans)
- Connection pooling handles concurrency

## Troubleshooting

### Common Issues

**spaCy Model Not Found:**
- Check build logs for model download
- Verify `python -m spacy download en_core_web_sm` in build command

**Database Connection Issues:**
- Check DATABASE_URL format
- Verify database is running
- Check connection pooling settings

**Memory Issues:**
- Reduce worker count
- Upgrade instance size
- Optimize text processing

**Performance Issues:**
- Check health endpoint
- Review logs for bottlenecks
- Consider database query optimization

### Debug Mode
For debugging, temporarily set:
- `LOG_LEVEL`: `DEBUG`
- `ENVIRONMENT`: `development`

## Maintenance

### Updates
1. Push changes to GitHub
2. Render auto-deploys from main branch
3. Monitor health endpoint after deployment

### Database Migrations
- Automatic table creation on startup
- Manual migrations via database console if needed

### Backups
- Render handles database backups automatically
- Export user data via API if needed

## Security Checklist

- [ ] SECRET_KEY is properly generated
- [ ] Database credentials are secure
- [ ] CORS origins are properly configured
- [ ] HTTPS is enforced
- [ ] Security headers are enabled
- [ ] Input validation is working
- [ ] Error messages don't leak sensitive info
- [ ] Logs don't contain sensitive data

## Performance Checklist

- [ ] Health endpoint responds quickly
- [ ] Database queries are optimized
- [ ] spaCy model loads successfully
- [ ] Memory usage is stable
- [ ] Response times are acceptable
- [ ] Auto-scaling is configured

## Support

For issues:
1. Check health endpoint
2. Review application logs in Render dashboard
3. Check database connectivity
4. Verify environment variables
5. Test with minimal input

## Cost Optimization

### Render Pricing
- Web Service: $7/month (Starter)
- PostgreSQL: $7/month (Starter)
- Total: ~$14/month for basic production setup

### Optimization Tips
- Use appropriate instance sizes
- Monitor usage patterns
- Scale down during low usage
- Optimize database queries
- Use caching where appropriate 